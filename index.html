<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem e-Tasmik & Rekod Al-Quran (Cloud)</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Prop-types -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; } /* Gray-100 background */
        .loader { border: 4px solid #e5e7eb; border-top: 4px solid #374151; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- KONFIGURASI GOOGLE SHEETS ---
        // Gantikan URL di bawah dengan URL Web App anda dari Google Apps Script Deployment
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw2RZRecH9nVm3-NuGRVmoKflpcHWHihn5YKMatvR5NtNJuakgQGNDI9NTKcmBottds/exec"; 

        // --- SUPPRESS CONSOLE WARNINGS ---
        const originalConsoleError = console.error;
        console.error = (...args) => {
            if (typeof args[0] === 'string' && /defaultProps/.test(args[0])) return;
            originalConsoleError(...args);
        };

        const { useState, useEffect, useMemo } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
        
        // --- Icons ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const BarChart2 = (props) => <IconBase {...props}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></IconBase>;
        const Save = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>;
        const Cloud = (props) => <IconBase {...props}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;

        // --- Helper Functions ---
        const calculateJuzuk = (page) => {
            if (!page || page < 1) return 0;
            if (page <= 21) return 1;
            const juzuk = Math.floor((page - 22) / 20) + 2;
            return juzuk > 30 ? 30 : juzuk;
        };

        const formatDate = (dateStr) => {
            if(!dateStr) return "-";
            try {
                return new Date(dateStr).toLocaleDateString('ms-MY', { day: 'numeric', month: 'short', year: 'numeric' });
            } catch (e) { return dateStr; }
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);

        const StatCard = ({ title, value, icon: Icon, color }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex items-center space-x-4">
                <div className={`p-3 rounded-full ${color} bg-opacity-10`}>
                    <Icon className={`w-6 h-6 ${color.replace('bg-', 'text-')}`} />
                </div>
                <div>
                    <p className="text-xs text-gray-500 font-bold uppercase tracking-wider">{title}</p>
                    <h3 className="text-2xl font-bold text-gray-800">{value}</h3>
                </div>
            </div>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('rekod');
            const [students, setStudents] = useState([]);
            const [logs, setLogs] = useState([]);
            const [notification, setNotification] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [isConfigured, setIsConfigured] = useState(false);

            // Form States
            const [selectedClass, setSelectedClass] = useState('');
            const [selectedStudentId, setSelectedStudentId] = useState('');
            const [currentRecord, setCurrentRecord] = useState({
                tahap: 'Iqra 1',
                halaman: '',
                juzuk: '',
                tarikh: new Date().toISOString().split('T')[0],
                masa: new Date().toLocaleTimeString('it-IT').slice(0,5),
                kualiti: 'Lancar',
                catatan: ''
            });

            // --- GOOGLE SHEETS INTEGRATION ---
            const fetchData = async () => {
                if(GOOGLE_SCRIPT_URL.includes("PASTE_URL")) {
                    setIsConfigured(false);
                    return;
                }
                setIsConfigured(true);
                setIsLoading(true);
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const data = await response.json();
                    if(data.status === 'success') {
                        const validStudents = data.students.filter(s => s && s.name);
                        const validLogs = data.logs.filter(l => l && l.studentId);
                        setStudents(validStudents);
                        setLogs(validLogs);
                        showNotify("Data berjaya dimuat turun", "success");
                    }
                } catch (error) {
                    console.error("Error fetching data:", error);
                    showNotify("Gagal menyambung ke Cloud", "error");
                } finally {
                    setIsLoading(false);
                }
            };

            const postData = async (payload) => {
                setIsLoading(true);
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: "POST",
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    return result;
                } catch (error) {
                    console.error("Error posting:", error);
                    return { status: "error" };
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            const filteredStudents = useMemo(() => {
                return selectedClass ? students.filter(s => s.kelas === selectedClass) : [];
            }, [selectedClass, students]);

            const classList = useMemo(() => {
                return [...new Set(students.map(s => s.kelas))].sort();
            }, [students]);

            const handlePageChange = (e) => {
                const page = parseInt(e.target.value);
                setCurrentRecord(prev => ({
                    ...prev,
                    halaman: page,
                    juzuk: currentRecord.tahap === 'Al-Quran' ? calculateJuzuk(page) : ''
                }));
            };

            const handleSubmitRecord = async (e) => {
                e.preventDefault();
                if (!selectedStudentId) return showNotify("Pilih murid dahulu", "error");

                const newLog = {
                    id: generateId(),
                    studentId: selectedStudentId,
                    ...currentRecord,
                    timestamp: new Date().toISOString()
                };

                setLogs([newLog, ...logs]);

                const payload = { action: "addLog", ...newLog };
                await postData(payload);
                showNotify("Rekod disimpan!", "success");
                
                setCurrentRecord(prev => ({ ...prev, halaman: '', juzuk: '', catatan: '' }));
            };

            const [newStudentName, setNewStudentName] = useState('');
            const [newStudentClass, setNewStudentClass] = useState('');

            const handleAddStudent = async () => {
                if (!newStudentName || !newStudentClass) return;
                const newStudent = { id: generateId(), name: newStudentName, kelas: newStudentClass };
                setStudents([...students, newStudent]);
                await postData({ action: "addStudent", ...newStudent });
                setNewStudentName('');
                setNewStudentClass('');
                showNotify("Murid ditambah", "success");
            };

            const generateIndividualPDF = (student) => {
                const doc = new jspdf.jsPDF();
                const studentLogs = logs.filter(l => l.studentId === student.id).sort((a,b) => new Date(a.tarikh) - new Date(b.tarikh));
                doc.setFontSize(18); doc.text(`Laporan: ${student.name}`, 14, 20);
                doc.setFontSize(12); doc.text(`Kelas: ${student.kelas}`, 14, 30);
                const tableData = studentLogs.map(log => [formatDate(log.tarikh), log.tahap, log.tahap === 'Al-Quran' ? `Juz ${log.juzuk} (Hlm ${log.halaman})` : log.halaman || '-', log.kualiti, log.catatan]);
                doc.autoTable({ startY: 45, head: [['Tarikh', 'Tahap', 'Bacaan', 'Kualiti', 'Catatan']], body: tableData, theme: 'grid' });
                doc.save(`Laporan_${student.name}.pdf`);
            };

            const generateFullReportPDF = () => {
                const doc = new jspdf.jsPDF();
                doc.setFontSize(18); doc.text(`Laporan Keseluruhan Kelas`, 14, 20);
                const tableData = students.map(student => {
                    const studentLogs = logs.filter(l => l.studentId === student.id);
                    const lastLog = studentLogs.length > 0 ? studentLogs[0] : null; 
                    return [student.name, student.kelas, lastLog ? lastLog.tahap : 'Tiada', lastLog && lastLog.tahap === 'Al-Quran' ? `Juz ${lastLog.juzuk}` : '-'];
                });
                doc.autoTable({ startY: 30, head: [['Nama', 'Kelas', 'Tahap', 'Pencapaian']], body: tableData, theme: 'grid' });
                doc.save('Laporan_Keseluruhan.pdf');
            };

            const showNotify = (msg, type) => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const getLatestLog = (studentId) => logs.find(l => l.studentId === studentId);
            const stats = useMemo(() => {
                const totalStudents = students.length;
                const byTahap = { 'Iqra': 0, 'Al-Quran': 0, 'Khatam': 0 };
                const juzukDist = Array(30).fill(0);
                students.forEach(s => {
                    const log = getLatestLog(s.id);
                    if (log) {
                        if (log.tahap.includes('Iqra')) byTahap['Iqra']++;
                        else if (log.tahap === 'Al-Quran') { byTahap['Al-Quran']++; if(log.juzuk > 0) juzukDist[log.juzuk - 1]++; }
                        else if (log.tahap === 'Khatam') byTahap['Khatam']++;
                    }
                });
                return { totalStudents, 
                         dataByTahap: Object.keys(byTahap).map(k => ({ name: k, value: byTahap[k] })),
                         dataByJuzuk: juzukDist.map((c, i) => ({ juzuk: `J${i+1}`, count: c })) };
            }, [students, logs]);

            if (!isConfigured) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 flex-col p-8 text-center">
                        <AlertCircle className="w-16 h-16 text-gray-400 mb-4" />
                        <h1 className="text-2xl font-bold text-gray-800 mb-2">Konfigurasi Diperlukan</h1>
                        <p className="text-gray-600 max-w-lg mb-6">Sila paste URL Google Apps Script anda ke dalam kod pada baris <code>const GOOGLE_SCRIPT_URL</code>.</p>
                        <div className="bg-white p-6 rounded border border-gray-200 shadow-sm text-sm text-left">
                            <p className="mb-2 font-semibold">Langkah Mudah:</p>
                            <ol className="list-decimal list-inside space-y-1 text-gray-600">
                                <li>Buka fail HTML dalam Notepad.</li>
                                <li>Cari <b>const GOOGLE_SCRIPT_URL = "..."</b></li>
                                <li>Masukkan URL Web App Google Script anda.</li>
                                <li>Simpan dan Refresh.</li>
                            </ol>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-10 relative text-gray-800">
                    {/* Loading Overlay */}
                    {isLoading && (
                        <div className="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white p-4 rounded-lg shadow-xl flex items-center space-x-3">
                                <div className="loader"></div>
                                <span className="font-medium text-gray-700">Menghubungi Pelayan...</span>
                            </div>
                        </div>
                    )}

                    {notification && (
                        <div className={`fixed top-5 right-5 px-6 py-3 rounded-lg shadow-lg z-50 text-white flex items-center space-x-2 animate-fade-in-down ${notification.type === 'error' ? 'bg-red-600' : 'bg-gray-800'}`}>
                            {notification.type === 'error' ? <AlertCircle size={20}/> : <CheckCircle size={20}/>}
                            <span>{notification.msg}</span>
                        </div>
                    )}

                    <nav className="bg-gray-900 text-white shadow-md sticky top-0 z-40 border-b border-gray-800">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between h-16 items-center">
                                <div className="flex items-center space-x-3">
                                    <BookOpen className="h-8 w-8 text-gray-400" />
                                    <div>
                                        <span className="font-bold text-xl block leading-none tracking-tight">e-Tasmik</span>
                                        <span className="text-xs text-gray-400 flex items-center gap-1 mt-0.5"><Cloud size={10}/> Cloud Sync Active</span>
                                    </div>
                                </div>
                                <div className="flex space-x-2">
                                    {[{ id: 'rekod', label: 'Rekod', icon: FileText }, { id: 'murid', label: 'Murid', icon: Users }, { id: 'laporan', label: 'Laporan', icon: BarChart2 }].map(tab => (
                                        <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex items-center space-x-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ${activeTab === tab.id ? 'bg-gray-800 text-white shadow-sm border border-gray-700' : 'text-gray-400 hover:bg-gray-800 hover:text-gray-200'}`}>
                                            <tab.icon size={16} /> <span className="hidden md:inline">{tab.label}</span>
                                        </button>
                                    ))}
                                    <button onClick={fetchData} className="ml-2 bg-gray-800 p-2 rounded border border-gray-700 text-gray-400 hover:text-white hover:border-gray-500 transition-colors" title="Refresh Data"><Cloud size={18}/></button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
                        {activeTab === 'rekod' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div className="lg:col-span-1 space-y-6">
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                        <h2 className="text-lg font-bold text-gray-800 mb-5 flex items-center border-b pb-3 border-gray-100">
                                            <Users className="mr-2 text-gray-600" size={20}/> Pilih Murid
                                        </h2>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wide">Kelas</label>
                                                <select value={selectedClass} onChange={(e) => { setSelectedClass(e.target.value); setSelectedStudentId(''); }} className="w-full bg-gray-50 border-gray-300 rounded-md shadow-sm border p-2.5 focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition-shadow">
                                                    <option value="">-- Pilih Kelas --</option>
                                                    {classList.map(c => <option key={c} value={c}>{c}</option>)}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wide">Nama Murid</label>
                                                <select value={selectedStudentId} onChange={(e) => setSelectedStudentId(e.target.value)} disabled={!selectedClass} className="w-full bg-gray-50 border-gray-300 rounded-md shadow-sm border p-2.5 disabled:bg-gray-100 disabled:text-gray-400 focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition-shadow">
                                                    <option value="">-- Pilih Nama --</option>
                                                    {filteredStudents.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    {selectedStudentId && (() => {
                                        const lastLog = getLatestLog(selectedStudentId);
                                        const curStudent = students.find(s => s.id === selectedStudentId);
                                        return (
                                            <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm">
                                                <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 border-b border-gray-200 pb-2">Status Terkini</h3>
                                                {lastLog ? (
                                                    <div className="space-y-3 text-sm">
                                                        <div className="flex justify-between items-center"><span className="text-gray-500">Tarikh</span> <span className="font-semibold text-gray-800">{formatDate(lastLog.tarikh)}</span></div>
                                                        <div className="flex justify-between items-center"><span className="text-gray-500">Tahap</span> <span className="px-2 py-0.5 bg-gray-200 rounded text-gray-700 font-semibold text-xs">{lastLog.tahap}</span></div>
                                                        {lastLog.tahap === 'Al-Quran' && <div className="flex justify-between items-center"><span className="text-gray-500">Lokasi</span> <span className="font-semibold text-gray-800">Juz {lastLog.juzuk} / Hlm {lastLog.halaman}</span></div>}
                                                    </div>
                                                ) : <p className="text-gray-400 italic text-sm py-2 text-center">Tiada rekod bacaan.</p>}
                                                <button onClick={() => generateIndividualPDF(curStudent)} className="mt-6 w-full bg-white border border-gray-300 text-gray-700 py-2.5 rounded-lg text-sm font-semibold hover:bg-gray-50 hover:border-gray-400 transition-all flex items-center justify-center shadow-sm">
                                                    <Download className="w-4 h-4 mr-2"/> Laporan Individu
                                                </button>
                                            </div>
                                        )
                                    })()}
                                </div>

                                <div className="lg:col-span-2">
                                    <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                        <div className="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                            <h2 className="text-lg font-bold text-gray-800 flex items-center">
                                                <FileText className="mr-2 text-gray-600"/> Borang Kemaskini
                                            </h2>
                                        </div>
                                        <form onSubmit={handleSubmitRecord} className="p-6 space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Tahap Bacaan</label>
                                                    <select value={currentRecord.tahap} onChange={(e) => setCurrentRecord({...currentRecord, tahap: e.target.value})} className="w-full border-gray-300 rounded-lg p-2.5 border focus:ring-2 focus:ring-gray-500 focus:border-gray-500 bg-gray-50">
                                                        <optgroup label="Iqra">{[1,2,3,4,5,6].map(i => <option key={i} value={`Iqra ${i}`}>Iqra {i}</option>)}</optgroup>
                                                        <option value="Al-Quran">Al-Quran</option><option value="Khatam">Khatam</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">{currentRecord.tahap === 'Al-Quran' ? 'Halaman' : 'Lokasi'}</label>
                                                    <input type={currentRecord.tahap === 'Al-Quran' ? "number" : "text"} value={currentRecord.halaman} onChange={handlePageChange} className="w-full border-gray-300 rounded-lg p-2.5 border focus:ring-2 focus:ring-gray-500 focus:border-gray-500 bg-gray-50" required placeholder="Masukkan lokasi..."/>
                                                    {currentRecord.tahap === 'Al-Quran' && currentRecord.juzuk && <p className="text-xs text-gray-500 mt-1 italic">Automatik: Juzuk {currentRecord.juzuk}</p>}
                                                </div>
                                                <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Tarikh</label><input type="date" value={currentRecord.tarikh} onChange={(e) => setCurrentRecord({...currentRecord, tarikh: e.target.value})} className="w-full border-gray-300 rounded-lg p-2.5 border focus:ring-2 focus:ring-gray-500 focus:border-gray-500 bg-gray-50"/></div>
                                                <div><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Masa</label><input type="time" value={currentRecord.masa} onChange={(e) => setCurrentRecord({...currentRecord, masa: e.target.value})} className="w-full border-gray-300 rounded-lg p-2.5 border focus:ring-2 focus:ring-gray-500 focus:border-gray-500 bg-gray-50"/></div>
                                                <div className="md:col-span-2">
                                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-2">Kualiti Bacaan</label>
                                                    <div className="flex space-x-4">
                                                        {['Lancar', 'Sederhana', 'Merangkak'].map(k => (
                                                            <label key={k} className={`flex-1 border rounded-lg p-3 cursor-pointer text-center transition-all ${currentRecord.kualiti === k ? 'border-gray-600 bg-gray-800 text-white shadow-md' : 'border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                                                                <input type="radio" name="kualiti" value={k} checked={currentRecord.kualiti === k} onChange={(e) => setCurrentRecord({...currentRecord, kualiti: e.target.value})} className="sr-only"/>
                                                                <span className="text-sm font-medium">{k}</span>
                                                            </label>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="md:col-span-2"><label className="block text-xs font-bold text-gray-500 uppercase mb-1">Catatan Guru</label><textarea rows="2" value={currentRecord.catatan} onChange={(e) => setCurrentRecord({...currentRecord, catatan: e.target.value})} className="w-full border-gray-300 rounded-lg p-2.5 border focus:ring-2 focus:ring-gray-500 focus:border-gray-500 bg-gray-50" placeholder="Contoh: Perlu perbaiki makhraj..."></textarea></div>
                                            </div>
                                            <div className="flex justify-end pt-4 border-t border-gray-100">
                                                <button type="submit" disabled={!selectedStudentId} className="bg-gray-900 text-white px-8 py-3 rounded-lg font-medium shadow hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                                                    <Save className="mr-2 w-5 h-5"/> Simpan
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'murid' && (
                            <div className="space-y-8">
                                <div className="bg-white p-8 rounded-xl shadow-sm border border-gray-200 max-w-2xl mx-auto">
                                    <h3 className="font-bold text-xl text-gray-800 mb-6 flex items-center border-b pb-4 border-gray-100"><Users className="w-6 h-6 mr-3 text-gray-600"/> Pendaftaran Murid</h3>
                                    <div className="grid grid-cols-1 gap-5">
                                        <input type="text" placeholder="Nama Penuh Murid" value={newStudentName} onChange={(e) => setNewStudentName(e.target.value)} className="border-gray-300 p-3 rounded-lg border bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all"/>
                                        <input type="text" placeholder="Kelas (Contoh: 1 Ibnu Sina)" value={newStudentClass} onChange={(e) => setNewStudentClass(e.target.value)} className="border-gray-300 p-3 rounded-lg border bg-gray-50 focus:ring-2 focus:ring-gray-500 focus:border-gray-500 outline-none transition-all"/>
                                        <button onClick={handleAddStudent} className="bg-gray-800 text-white py-3 rounded-lg hover:bg-gray-700 font-medium shadow-sm transition-colors">Daftar Murid</button>
                                    </div>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                    <div className="p-5 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
                                        <h3 className="font-bold text-gray-700">Direktori Murid</h3>
                                        <select value={selectedClass} onChange={(e) => setSelectedClass(e.target.value)} className="border-gray-300 rounded-md border p-1.5 text-sm bg-white focus:ring-1 focus:ring-gray-500">
                                            <option value="">Semua Kelas</option>{classList.map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Nama</th>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Kelas</th>
                                                    <th className="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tahap</th>
                                                    <th className="px-6 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Tindakan</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {(selectedClass ? filteredStudents : students).map((student) => { 
                                                    const lastLog = getLatestLog(student.id); 
                                                    return (
                                                        <tr key={student.id} className="hover:bg-gray-50 transition-colors">
                                                            <td className="px-6 py-4 font-medium text-gray-900">{student.name}</td>
                                                            <td className="px-6 py-4 text-gray-500">{student.kelas}</td>
                                                            <td className="px-6 py-4">
                                                                {lastLog ? <span className="px-2.5 py-1 text-xs font-semibold rounded-md bg-gray-100 text-gray-700 border border-gray-200">{lastLog.tahap} {lastLog.tahap === 'Al-Quran' ? `(J${lastLog.juzuk})` : ''}</span> : <span className="text-gray-400 text-xs">-</span>}
                                                            </td>
                                                            <td className="px-6 py-4 text-right">
                                                                <button onClick={() => generateIndividualPDF(student)} className="text-gray-500 hover:text-gray-900 transition-colors" title="Muat Turun PDF">
                                                                    <Download className="w-5 h-5"/>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ); 
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'laporan' && (
                            <div className="space-y-8">
                                <div className="flex justify-end space-x-4">
                                    <button onClick={generateFullReportPDF} className="flex items-center bg-gray-800 text-white px-5 py-2.5 rounded-lg shadow-sm hover:bg-gray-700 transition-colors font-medium text-sm">
                                        <FileText className="w-4 h-4 mr-2"/> Laporan Kelas (PDF)
                                    </button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <StatCard title="Jumlah Murid" value={stats.totalStudents} icon={Users} color="bg-gray-500" />
                                    <StatCard title="Al-Quran" value={stats.dataByTahap.find(d => d.name === 'Al-Quran')?.value || 0} icon={BookOpen} color="bg-gray-700" />
                                    <StatCard title="Khatam" value={stats.dataByTahap.find(d => d.name === 'Khatam')?.value || 0} icon={CheckCircle} color="bg-gray-900" />
                                </div>
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-80">
                                        <h4 className="text-sm font-bold text-gray-500 uppercase mb-4">Statistik Tahap</h4>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={stats.dataByTahap}>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#f3f4f6" />
                                                <XAxis dataKey="name" stroke="#9ca3af" fontSize={12} tickLine={false} axisLine={false} />
                                                <YAxis allowDecimals={false} stroke="#9ca3af" fontSize={12} tickLine={false} axisLine={false} />
                                                <Tooltip cursor={{fill: '#f9fafb'}} contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'}} />
                                                <Bar dataKey="value" fill="#4b5563" radius={[4, 4, 0, 0]} barSize={50} />
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200 h-80">
                                        <h4 className="text-sm font-bold text-gray-500 uppercase mb-4">Taburan Juzuk</h4>
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={stats.dataByJuzuk}>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#f3f4f6" />
                                                <XAxis dataKey="juzuk" interval={4} stroke="#9ca3af" fontSize={12} tickLine={false} axisLine={false} />
                                                <YAxis allowDecimals={false} stroke="#9ca3af" fontSize={12} tickLine={false} axisLine={false} />
                                                <Tooltip contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'}} />
                                                <Line type="monotone" dataKey="count" stroke="#1f2937" strokeWidth={3} dot={{fill: '#1f2937', r: 3}} activeDot={{r: 6}} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
